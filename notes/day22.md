## [Day 22] 페이지랭크 & 전파 모델
### [Graph 3강] 검색 엔진에서는 그래프를 어떻게 활용할까?
#### 1. 페이지랭크의 배경
+ 웹은 웹페이지와 하이퍼링크로 구성된 거대한 방향성이 있는 그래프
+ 웹페이지는 정점, 하이퍼링크는 간선에 해당
+ 구글 이전의 검색엔진 - 1
    + 초창기의 웹은 거대한 디렉토리로 정리함
    + 웹페이지의 수가 증가함에 따라서 카테고리의 수와 깊이도 무한정 커지는 문제
    + 카테고리 구분이 모호한 경우가 많아, 저장과 검색이 어려움
+ 구글 이전의 검색엔진 - 2
    + 웹페이지에 포함된 키워드에 의존한 검색 엔진
    + 이 방법은 악의적인 웹페이지에 취약하다는 단점
    + 성인 사이트에 축구라는 키워드를 입력하는 등 다양하게 악용이 가능
+ 구글의 창업자 래리 페이지와 세르게이 브린은 The PageRank Citation Ranking이라는 논문을 통해 이 문제를 해결
    + http://ilpubs.stanford.edu:8090/422/1/1999-66.pdf

#### 2. 페이지랭크의 정의
+ 페이지랭크의 핵심 아이디어는 투표
+ 즉 투표를 통해 사용자 키워드와 관련성이 높고 신뢰할 수 있는 웹페이지를 찾음
+ 웹페이지는 하이퍼링크를 통해 투표를함
+ 들어오는 간선이 많을 수록 신뢰할 수 있다는 뜻
    + 웹페이지를 여러 개 만들어서 간선의 수를 부풀릴 수 있음, 관련성과 신뢰도가 높아 보이도록 조작이 가능
+ 악용에 의한 효과를 줄이기 위해 페이지랭크에서는 가중 투표를 함
    + 관련성이 높고 신뢰할 수 있는 웹사이트의 투표를 더 중요하게 간주하는 방법
    + 관련성과 신뢰성은 투표를 통해 측정하고 이를 다시 입력으로 사용함, 재귀(Recursion) 방법
+ 측정하려는 웹페이지의 관련성 및 신뢰도를 페이지랭크 점수라고 부름
    + 각 웹페이지는 각각의 나가는 이웃에게 (자신의 페이지랭크 점수 / 나가는 이웃의 수) 만큼의 가중치로 투표를 함
+ 각 웹페이지의 페이지랭크 점수는 받은 투표의 가중치 합으로 정의됨

![캡처](https://user-images.githubusercontent.com/44515744/108792623-0c483d00-75c5-11eb-9d61-f246352e9e9e.PNG)

+ 페이지랭크는 임의 보행 관점(Random Walk)으로도 정의할 수 있음
    + 웹을 서핑하는 웹서퍼를 가정할 때, 웹서퍼는 웹페이지에 있는 하이퍼링크 중 하나를 균일한 확률로 클릭하는 방식으로 웹을 서핑함
    + 웹서퍼가 t번째 방문한 웹페이지가 웹페이지 i일 확률을 p_{i}(t)라고 함, 그러면 p(t)는 길이가 웹페이지 수와 같은 확률분포 벡터가 됨
    + p(t)는 길이가 웹페이지 수와 같은 확률분포 벡터가 됨
    + 웹서퍼가 이 과정을 무한히 반복하고 나면, 즉 t가 무한히 커지면 확률 분포 p(t)는 수렴하게 됨
        + 다시 말해 p(t) = p(t + 1) = p가 성립됨
        + 수렴한 확률 분포 p는 정상 분포(Stationary Distribution)이라고 부름
        + 결과적으로 투표 관점에서 정의한 투표 관점고 동일함

    ![캡처](https://user-images.githubusercontent.com/44515744/108793801-c2ad2180-75c7-11eb-9f40-97998ffe4e8e.PNG)

#### 3. 페이지랭크의 계산
+ 페이지랭크 점수의 계산에는 반복곱(Power Iteration)을 사용함
    + 각 웹페이지 i의 페이지랭크 점수를 동일하게 (1 / 웹페이지의 수)로 초기화
    + 이 상태에서 각 정점에 대한 페이지랭크 점수를 계산 ( 자신의 페이지랭크 점수 / 나가는 이웃의 수 )
    + 정점에 들어오는 점수들을 합산함
    + 이전 단계와 현재 단계의 값이 수렴했는지를 확인
    + 업데이트된 페이지랭크를 기준으로 다시 각 정점에 대한 점수를 계산 ( 반복 )

    ![캡처](https://user-images.githubusercontent.com/44515744/108800977-da8ca180-75d7-11eb-98ae-e71b572a2431.PNG)

+ 반복곱이 항상 수렴하는 것을 보장하지 않음 
    + 들어오는 간선은 있지만 나가는 간선은 없는 정점 집합을 스파이더 트랩(Spider Trap)이라고 함

    ![캡처](https://user-images.githubusercontent.com/44515744/108802459-afa44c80-75db-11eb-888a-bcdcf0f89fd8.PNG)

+ 반복곱이 "합리적인" 점수로 수렴하는 것을 보장하지 않음
    + 들어오는 간선은 있지만 나가는 간선은 없는 막다른 정점(Dead End)에 의한 문제

    ![캡처](https://user-images.githubusercontent.com/44515744/108802560-feea7d00-75db-11eb-9385-4d080cf12622.PNG)

#### 4. 문제점과 해결책
+ 임의 보행 관점에서, 웹을 서핑하는 웹서퍼의 행동을 다음과 같이 수정
    + 현재 웹페이지에 하이퍼링크가 없다면, 임의의 웹페이지로 순간이동함
    + 현재 웹페이지에 하이퍼링크가 있다면, 앞면이 나올 확률이 a인 동전을 던짐
    + 앞면이라면, 하이퍼링크 중 하나를 균일한 확률로 선택해 클릭
    + 뒷면이라면, 임의의 웹페이지로 순간이동
    + a를 감폭 비율(Damping Factor)이라고 부르며 값으로 보통 0.8 정도를 사용
    + 아래 수식의 |V|는 전체 웹페이지의 수를 의미함
    + 파란색 부분은 하이퍼링크를 따라 정점 j에 도착할 확률
    + 빨간색 부분은 순간이동을 통해 정점 j에 도착할 확률

    ![캡처](https://user-images.githubusercontent.com/44515744/108803054-137b4500-75dd-11eb-8da5-3669c38d6483.PNG)

    + 수정된 페이지랭크 점수 예시
        + 각 숫자는 페이지랭크 점수에 100을 곱한것
        + 겉에 있는 정점은 이곳으로 투표하는 정점이 없기 때문에 점수가 낮음
        + C라는 정점이 점수가 높은 이유는 한개의 간선이 가장 페이지랭크 점수 값이 높은 B로부터 들어오기 때문
        + 우측 상단의 C는 막다른 정점이지만 

    ![캡처](https://user-images.githubusercontent.com/44515744/108803335-c51a7600-75dd-11eb-8033-9fa1aa98549c.PNG)

#### 5. 정리
+ 페이지랭크의 배경
    + 디렉토리, 키워드 기반 검색 엔진의 한계
+ 페이지랭크의 정의
    + 투표 관점: 하이퍼링크를 통한 가중 투표
    + 임의 보행 관점: 웹서퍼가 각 웹페이지를 방문할 확률
+ 페이지랭크의 계산
    + 반복곱
    + 스파이더 트랩 및 막다른 정점 문제를 해결하기 위한 순간 이동

### [Graph 4강] 그래프를 바이럴 마케팅에 어떻게 활용할까?
#### 1. 그래프를 통한 전파의 예시
+ 온라인 소셜 네트워크를 통해 다양한 정보가 전파됨( 스페인의 15M 운동, 과학적 정보가 전파되기도 함 )
+ 온라인 소셜 네트워크를 통해 다양한 행동도 전파됨( 아이스 버킷 챌린지, 펭귄 문제 등이 대표적인 예시 )
+ 컴퓨터 네트워크에서의 일부 장비의 고장이 전파되어 전체 네트워크를 마비시킬 수 있음
+ 사회라는 거대한 소셜 네트워크를 통한 질병의 전파도 포함됨 ( 메르스, 사스, 코로나-19 )

#### 2. 언제 의사결정 기반의 전파 모형을 사용하는지?
+ 두 경우 모두 주변 사람들의 의사결정이 본인의 의사결정에 영향을 미침
    + 친구들이 카카오톡을 쓰면 나도 카카오톡을 써야지 편함
    + 주변 사람들의 의사결정을 고려하여 각자 의사결정을 내리틑 경우에 의사결정 기반의 전파 모형을 사용

#### 3. 선형 임계치 모형(Linear Threshold Model)
+ 친구, 상품 예시
    + 친구 관계의 두 사람 u와 v를 가정
    + 둘은 두 개의 호환되지 않는 기술 A와 B 중에서 하나를 선택
    + 둘 모두 다른 것을 사용할 경우 행복이 0
    + A를 선택하면 a만큼 행복이 증가, B를 선택하면 b만큼 행복이 증가

+ 소셜 네트워크에서 각자가 행복이 최대화되는 선택을 한다고 가정
    + p를 선택한 이웃의 비율이 임계치 q보다 클때 정점은 A를 선택함

![캡처](https://user-images.githubusercontent.com/44515744/108808218-7c68ba00-75e9-11eb-81ca-f0a7d21df97f.PNG)

+ 위 모형을 선형 임계치 모형(Linear Threshold Model)이라고 함
    + 각 정점은 이웃 중 A를 선택한 비율이 임계치 q를 넘을 때만 A를 선택함
    + 이 모형은 전부 B를 사용하는 상황을 가정하고 A 사용자들을 얼리 어답터들이라고 가정함
    + 시드 집합(Seed Set)이라고 불리는 얼리 어답터들은 항상 A를 고수한다고 가정
    + 임계치 q가 55%를 가정할 때 u,v의 선택을 고려하여 다른 정점들이 다시 기술을 선택함
    + 이 순서를 반복하여 새로 A를 고수한 정점들이 영향을 다른 B를 사용하는 정점들에게 전파하게됨

![캡처](https://user-images.githubusercontent.com/44515744/108809077-6b20ad00-75eb-11eb-83da-9a4301812d50.PNG)

#### 4. 확률적 전파 모형
+ 의사결정 기반 모형은 적합하지 않음, 누구도 코로나에 걸리기로 의사결정을 내리는 사람이 없기 때문
+ 코로나의 전파는 확률적 과정이기 때문에 확률적 전파 모형을 고려해야함

#### 5. 독립 전파 모형(Independent Cascade Model)
+ 방향성이 있고 가중치가 있는 그래프를 가정함
+ 각 간선 (u, v)의 가중치 p_{uv}는 u가 감영되었을 때 u가 v를 감염시킬 확률에 해당함
+ 즉, 각 정점 u가 감염될 때마다, 각 이웃 v는 p_{uv}확률로 전염됨
+ 위 과정을 새로운 감영자 각각에게 반복함
+ 서로 다른 이웃이 전영되는 확률은 아래와 같이 독립적임

    ![캡처](https://user-images.githubusercontent.com/44515744/108809531-66a8c400-75ec-11eb-922a-99857a716b81.PNG)

+ 이전 모형과 마찬가지로 첫 감염자들을 시드 집합(Seed Set)이라고 부름
+ 독립적 전파 모형은 감염자가 계속 감염된 상태로 남아있는 것을 가정함
+ 감영자의 회복을 가정하는 SIS, SIR 등의 다른 전파 모형도 존재함

#### 6. 바이럴 마케팅과 전파 최대화 문제
+ 바이럴 마케팅은 소비자들로 하여금 상품에 대한 긍정적인 입소문을 내게하는 기법
+ 바이럴 마케팅이 효과적이기 위해서는 소문의 시작점이 중요함(시작점이 어디인지에 따라서 입소문이 전파되는 범위가 영향을 받기 때문)
+ 소셜 인플루언서(Social Influencer)들이 높은 광고비를 받는 이유
+ 앞서 소개한 전파 모형들에서도 시드 집합이 전파 크기에 많은 영향을 미침
    + 영향력이 없는 정점을 사용하게 될 경우 전파가 되지않음

#### 7. 전파 최대화 문제(Influence Maximization)
+ 그래프, 전파 모형 그리고 시드 집합의 크기가 주어졌을 때 전파를 최대화하는 시드 집합을 찾는 문제를 전파 최대화 문제라고 함
+ 전파 모형으로는 앞서 배운 선형 임계치 모형, 독립 전파 모형을 포함 다양한 모형을 고려할 수 있음
+ 전파 최대화 문제는 굉장히 어려운 문제
+ 그래프에 |V|개의 정점이 있을 경우, 시드 집합의 크기를 k개로 제한하더라도 경우의 수는 아래와 같음
    + 정점이 많아질 경우에 그 경우의 수는 엄청나게 많아짐
    + 이론적으로 많은 전파 모형에 대하여 전파 최대화 문제는 NP-hard임이 증명되어 최고의 시드 집합을 찾는것은 포기함

![캡처](https://user-images.githubusercontent.com/44515744/108810275-22b6be80-75ee-11eb-9f05-36dcc80792a6.PNG)

#### 8. 정점 중심성 휴리스틱 - 휴리스틱(heuristics) 또는 발견법
+ 대표적 휴리스틱으로 정점의 중심성(Node Centrality)을 사용함
+ 휴리스틱은 실험적으로는 잘 도착할 수 있으나 이론적으로는 정확도에 대해서 어떠한 보장도 할 수 없음
+ 시드 집합의 크기가 k개로 고정되어 있을때 정점의 중심성이 높은 순으로 k개의 정점을 선택하는 방법
    + 정점의 중심성을 측정하는 방법은 페이지랭크 점수, 연결 중심성, 근접 중심성, 매개 중심성 등 여러가지가 있음
    + 연결 중심성의 경우 연결성이 높은 것이 높은 중심성을 갖음
    + 최고의 시드 집합을 찾는다는 보장은 없음

#### 9. 탐욕 알고리즘(Greedy Alogrithm) 역시 많이 사용
+ 탐욕 알고리즘은 시드 집합의 원소, 즉 최초 전파자를 한번에 한 명씩 선택함
+ 집합 {1}, {2}, ... , {|V|}를 비교하여, 전파를 최대화하는 시드 집합{x}을 찾음 
+ 그 다음 {x,1}, {x,2}, ... , {x,|V|}를 비교하여, 전파를 최대화하는 시드 집합{x,y}을 찾음
    + y는 두번째 최초 전파자로 선발됨 
+ 이를 반복하여 목표하는 크기의 시드 집합에 도달할 때까지 반복
    + 최초 전파자 간의 조합의 효과를 고려하지 않고 근시안적으로 최초 전파자를 선택하는 과정을 반복
+ 독립 전파 모형에 경우, 이론적으로 정확도가 일부 보장됨
    + 입력 그래프와 무관하게 다음 부등식이 성립함

![캡처](https://user-images.githubusercontent.com/44515744/108813316-24838080-75f4-11eb-8659-df1146e8114e.PNG)

#### 10. 정리
+ 그래프를 통한 전파의 예시
    + 정보, 행동, 고장, 질병 등

+ 의사결정 기반의 전파 모형
    + 각각의 정점이 개인의 행복을 최대화하도록 의사결정하는 상황을 모형화
    + 대표 예시: 선형 임계치 모형
+ 확률적 전파 모형
    + 질병의 전파 등 확률적 과정을 모형화
    + 대표 예시: 독립적 전파 모형
+ 바이럴 마케팅과 전파 최대화 문제
    + 전파를 최대화하는 시드 집합을 찾는 문제
    + 정점 중심성 휴리스틱, 탐욕 알고리즘 등
